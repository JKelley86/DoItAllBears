<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Family Feud Host</title>
  <style>/* existing styling omitted for brevity */</style>
</head>
<body>
  <h1>Family Feud - Host View</h1>
  <div class="controls">
    <select id="feudType">
      <option value="FamilyFeud">Family Feud</option>
      <option value="WeddingFeud">Wedding Feud</option>
    </select>
    <button onclick="loadQuestions()">Load Selected Game</button>
    <button onclick="nextRound()">Next Round</button>
  </div>
  <h2 id="question">Waiting for questions...</h2>
  <div id="answers"></div>
  <div class="controls">
    Team A Score: <span id="teamAScore">0</span><br>
    Team B Score: <span id="teamBScore">0</span>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

  <script>
    const firebaseConfig = { /* your config */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const sheetMap = {
      FamilyFeud: 'pub?output=csv&gid=0',
      WeddingFeud: 'pub?output=csv&gid=1'
    };

    let questions = [], currentIndex=0, teamAScore=0, teamBScore=0;

    function loadQuestions() {
      const type = document.getElementById('feudType').value;
      const csvUrl = `https://docs.google.com/spreadsheets/d/e/2PACXâ€‘.../${sheetMap[type]}`;
      Papa.parse(csvUrl, {
        download: true,
        header: true,
        complete: results => {
          const grouped = {};
          results.data.forEach(r => {
            if (r.question) {
              grouped[r.question] = grouped[r.question] || [];
              grouped[r.question].push({
                text: r.answer,
                points: +r.points,
                revealed: false
              });
            }
          });
          questions = Object.entries(grouped).map(([q,a]) => ({ question:q, answers:a }));
          currentIndex=0; teamAScore=0; teamBScore=0;
          updateScoreUI(); showQuestion();
        }
      });
    }

    function showQuestion() {
      const q = questions[currentIndex];
      document.getElementById('question').textContent = q.question;
      const ad = document.getElementById('answers'); ad.innerHTML='';
      q.answers.forEach((ans,i)=>{
        const div = document.createElement('div');
        div.className = 'answer'; div.id = 'answer-'+i;
        div.innerHTML = `<span>${ans.text} (${ans.points} pts)</span>
                         <button onclick="reveal(${i},'A')">Team A</button>
                         <button onclick="reveal(${i},'B')">Team B</button>`;
        ad.appendChild(div);
      });
      db.ref('game/current').set({
        question: q.question,
        answers: q.answers.map(a=>({text:a.text,points:a.points,revealed:false})),
        team1:teamAScore, team2:teamBScore
      });
    }

    function reveal(i,t) {
      const ans = questions[currentIndex].answers[i];
      if (!ans.revealed) {
        ans.revealed=true;
        if (t==='A') teamAScore+=ans.points;
        else teamBScore+=ans.points;
        updateScoreUI();
        showRevealed();
      }
    }

    function showRevealed() {
      const q = questions[currentIndex];
      const snapshot = { question:q.question, answers:q.answers, team1:teamAScore, team2:teamBScore };
      db.ref('game/current').set(snapshot);
      showQuestion();  // refresh UI
    }

    function updateScoreUI(){
      document.getElementById('teamAScore').textContent=teamAScore;
      document.getElementById('teamBScore').textContent=teamBScore;
    }

    function nextRound(){
      if(currentIndex < questions.length-1){
        currentIndex++;
        showQuestion();
      } else alert('No more rounds!');
    }
  </script>
</body>
</html>
