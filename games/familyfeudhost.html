<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Family Feud - Host View</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <h1>üë®‚Äçüè´ Family Feud - Host View</h1>

  <button id="loadQuestions">Load Questions from Google Sheets</button>
  <button id="nextRound" disabled>Next Round</button>

  <h2 id="question">Waiting for questions...</h2>
  <div id="answers"></div>

  <h3>Team Scores</h3>
  <p>Team A: <span id="scoreA">0</span> <button onclick="updateScore('A', 10)">+10</button></p>
  <p>Team B: <span id="scoreB">0</span> <button onclick="updateScore('B', 10)">+10</button></p>

  <script>
    // Firebase setup
    const firebaseConfig = {
      apiKey: "AIzaSyBY8wm-BiRozfkQw9GontLmX-6uIMpavjc",
      authDomain: "family-feud-game-ea08a.firebaseapp.com",
      projectId: "family-feud-game-ea08a",
      storageBucket: "family-feud-game-ea08a.appspot.com",
      messagingSenderId: "901336964187",
      appId: "1:901336964187:web:53534171e5ebf2a751337e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allQuestions = [];
    let currentRound = -1;

    async function loadQuestionsFromGoogleSheets() {
      const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT8hWnxpAnGUMSl7VqP4rRFALVpaQ4LCd46XU_lyio6qSv847jmUUTX8EsQ3gRZ2db0hwTMVYfYlIPj/pub?output=csv';
      const res = await fetch(sheetURL);
      const data = await res.text();
      const rows = data.trim().split('\n').map(row => row.split(','));

      allQuestions = rows.slice(1).map(row => {
        return {
          question: row[0],
          answers: [
            { text: row[1], points: parseInt(row[2]) || 0 },
            { text: row[3], points: parseInt(row[4]) || 0 },
            { text: row[5], points: parseInt(row[6]) || 0 },
            { text: row[7], points: parseInt(row[8]) || 0 },
            { text: row[9], points: parseInt(row[10]) || 0 },
            { text: row[11], points: parseInt(row[12]) || 0 }
          ].filter(a => a.text)
        };
      });

      // Shuffle the questions
      for (let i = allQuestions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
      }

      document.getElementById('nextRound').disabled = false;
      alert('Questions loaded! Click "Next Round" to begin.');
    }

    function showNextRound() {
      currentRound++;
      if (currentRound >= allQuestions.length) {
        alert('No more questions!');
        return;
      }

      const q = allQuestions[currentRound];
      db.ref('game').set({
        question: q.question,
        answers: q.answers.map((a, i) => ({
          text: a.text,
          points: a.points,
          revealed: false
        }))
      });

      document.getElementById('question').textContent = q.question;
      renderAnswers(q.answers.map((a, i) => ({ ...a, revealed: false })));
    }

    function renderAnswers(answers) {
      const container = document.getElementById('answers');
      container.innerHTML = '';
      answers.forEach((a, i) => {
        const div = document.createElement('div');
        div.className = 'answer unrevealed';
        div.textContent = 'Click to Reveal';
        div.style.cursor = 'pointer';
        div.onclick = () => revealAnswer(i, a);
        container.appendChild(div);
      });
    }

    function revealAnswer(index, answer) {
      const divs = document.querySelectorAll('.answer');
      divs[index].className = 'answer revealed';
      divs[index].textContent = `${answer.text} - ${answer.points} pts`;

      db.ref(`game/answers/${index}/revealed`).set(true);
    }

    function updateScore(team, points) {
      const span = document.getElementById(`score${team}`);
      const current = parseInt(span.textContent) || 0;
      const newScore = current + points;
      span.textContent = newScore;

      db.ref(`scores/team${team}`).set(newScore);
    }

    document.getElementById('loadQuestions').addEventListener('click', loadQuestionsFromGoogleSheets);
    document.getElementById('nextRound').addEventListener('click', showNextRound);
  </script>

  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
    }
    #answers {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }
    .answer {
      padding: 20px;
      background: #ddd;
      border-radius: 5px;
      text-align: center;
      font-size: 18px;
    }
    .answer.revealed {
      background: #4caf50;
      color: white;
    }
  </style>
</body>
</html>
