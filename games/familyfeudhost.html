<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Family Feud Host</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    .question {
      font-size: 2em;
      margin: 20px 0;
    }
    .answer {
      background: #222;
      margin: 10px auto;
      padding: 10px;
      width: 80%;
      border-radius: 10px;
    }
    .answer.revealed {
      background: green;
    }
    .buttons {
      margin-top: 10px;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 1em;
      cursor: pointer;
    }
    .team-scores {
      margin: 20px 0;
      font-size: 1.5em;
    }
  </style>
</head>
<body>
  <h1>Family Feud Host</h1>

  <div class="team-scores">
    Team A: <span id="teamAScore">0</span> |
    Team B: <span id="teamBScore">0</span>
  </div>

  <div>
    <button onclick="loadQuestions()">Load Questions</button>
    <button onclick="nextQuestion()">Next Round</button>
    <button onclick="shuffleQuestions()">Randomize</button>
  </div>

  <div class="question" id="questionText">Click "Load Questions"</div>
  <div id="answers"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBY8wm-BiRozfkQw9GontLmX-6uIMpavjc",
      authDomain: "family-feud-game-ea08a.firebaseapp.com",
      projectId: "family-feud-game-ea08a",
      storageBucket: "family-feud-game-ea08a.appspot.com",
      messagingSenderId: "901336964187",
      appId: "1:901336964187:web:53534171e5ebf2a751337e",
      databaseURL: "https://family-feud-game-ea08a-default-rtdb.firebaseio.com/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let questions = [];
    let currentQuestionIndex = 0;
    let teamAScore = 0;
    let teamBScore = 0;

    function loadQuestions() {
      fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vT8hWnxpAnGUMSl7VqP4rRFALVpaQ4LCd46XU_lyio6qSv847jmUUTX8EsQ3gRZ2db0hwTMVYfYlIPj/pub?output=csv")
        .then(response => response.text())
        .then(csv => {
          const rows = csv.trim().split("\n").slice(1);
          questions = [];

          let current = null;
          for (let row of rows) {
            const [question, answer, points] = row.split(",");
            if (!current || current.question !== question) {
              current = { question, answers: [] };
              questions.push(current);
            }
            current.answers.push({ answer, points: parseInt(points), revealed: false });
          }

          currentQuestionIndex = 0;
          displayQuestion();
        });
    }

    function displayQuestion() {
      if (!questions[currentQuestionIndex]) return;
      const q = questions[currentQuestionIndex];

      document.getElementById("questionText").textContent = q.question;

      const answersDiv = document.getElementById("answers");
      answersDiv.innerHTML = "";

      q.answers.forEach((a, i) => {
        const div = document.createElement("div");
        div.className = "answer";
        div.id = `answer-${i}`;
        div.innerHTML = a.revealed
          ? `${a.answer} - ${a.points} pts`
          : "___________";

        const btnA = document.createElement("button");
        btnA.textContent = "Reveal (Team A)";
        btnA.onclick = () => revealAnswer(i, "A");

        const btnB = document.createElement("button");
        btnB.textContent = "Reveal (Team B)";
        btnB.onclick = () => revealAnswer(i, "B");

        const btnDiv = document.createElement("div");
        btnDiv.className = "buttons";
        btnDiv.appendChild(btnA);
        btnDiv.appendChild(btnB);

        div.appendChild(btnDiv);
        answersDiv.appendChild(div);
      });

      syncWithFirebase();
    }

    function revealAnswer(index, team) {
      const q = questions[currentQuestionIndex];
      if (q.answers[index].revealed) return;

      q.answers[index].revealed = true;

      const points = q.answers[index].points;
      if (team === "A") {
        teamAScore += points;
        document.getElementById("teamAScore").textContent = teamAScore;
      } else {
        teamBScore += points;
        document.getElementById("teamBScore").textContent = teamBScore;
      }

      displayQuestion();
    }

    function nextQuestion() {
      currentQuestionIndex = (currentQuestionIndex + 1) % questions.length;
      displayQuestion();
    }

    function shuffleQuestions() {
      for (let i = questions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questions[i], questions[j]] = [questions[j], questions[i]];
      }
      currentQuestionIndex = 0;
      displayQuestion();
    }

    function syncWithFirebase() {
      const q = questions[currentQuestionIndex];
      db.ref("game/currentQuestion").set({
        question: q.question,
        answers: q.answers.map(a => ({
          answer: a.revealed ? a.answer : "",
          points: a.revealed ? a.points : 0
        })),
        teamAScore,
        teamBScore
      });
    }
  </script>
</body>
</html>
