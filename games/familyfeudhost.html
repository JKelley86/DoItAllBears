<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Family Feud - Host</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #fff; text-align: center; }
    .answer { display: none; font-size: 24px; margin: 10px; }
    .revealed { display: block; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>Family Feud - Host View</h1>
  <h2 id="question"></h2>
  <div id="answers"></div>
  <button onclick="nextRound()">Next Round</button>
  <p>Team 1 Score: <span id="team1Score">0</span></p>
  <p>Team 2 Score: <span id="team2Score">0</span></p>
  <button onclick="loadQuestions()">Load Questions from Google Sheets</button>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // âœ… Your Firebase Config (from earlier)
    const firebaseConfig = {
      apiKey: "AIzaSyCp14HR7X_O5dGrEK4QyrPq3q5mf-nRXJQ",
      authDomain: "familyfeud-1df4a.firebaseapp.com",
      databaseURL: "https://familyfeud-1df4a-default-rtdb.firebaseio.com",
      projectId: "familyfeud-1df4a",
      storageBucket: "familyfeud-1df4a.appspot.com",
      messagingSenderId: "182167116439",
      appId: "1:182167116439:web:45a3d9d6f97f7fa1248e8c"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let questions = [];
    let currentIndex = 0;
    let scores = { team1: 0, team2: 0 };

    function loadQuestions() {
      fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vT8hWnxpAnGUMSl7VqP4rRFALVpaQ4LCd46XU_lyio6qSv847jmUUTX8EsQ3gRZ2db0hwTMVYfYlIPj/pub?output=csv")
        .then(res => res.text())
        .then(csv => {
          const rows = csv.split("\n").map(row => row.split(","));
          questions = rows.slice(1).map(row => {
            const question = row[0];
            const answers = [];
            for (let i = 1; i < row.length; i += 2) {
              if (row[i] && row[i+1]) {
                answers.push({ text: row[i], points: parseInt(row[i+1]) });
              }
            }
            return { question, answers };
          });
          currentIndex = 0;
          showQuestion();
        });
    }

    function showQuestion() {
      const q = questions[currentIndex];
      if (!q) return;
      document.getElementById("question").innerText = q.question;
      const answerDiv = document.getElementById("answers");
      answerDiv.innerHTML = "";
      q.answers.forEach((ans, idx) => {
        const container = document.createElement("div");
        container.className = "answer";
        container.id = "answer" + idx;
        container.innerText = `${ans.text} - ${ans.points} pts`;
        
        const btn1 = document.createElement("button");
        btn1.textContent = "Reveal - Team 1";
        btn1.onclick = () => revealAnswer(idx, 'team1');

        const btn2 = document.createElement("button");
        btn2.textContent = "Reveal - Team 2";
        btn2.onclick = () => revealAnswer(idx, 'team2');

        answerDiv.appendChild(container);
        answerDiv.appendChild(btn1);
        answerDiv.appendChild(btn2);
      });

      db.ref("game/currentQuestion").set(q);
      db.ref("game/revealedAnswers").set([]);
    }

    function revealAnswer(index, team) {
      const el = document.getElementById("answer" + index);
      if (el && !el.classList.contains("revealed")) {
        el.classList.add("revealed");

        const points = questions[currentIndex].answers[index].points;
        scores[team] += points;
        document.getElementById(team + "Score").innerText = scores[team];

        db.ref("game/revealedAnswers").once('value').then(snapshot => {
          const revealed = snapshot.val() || [];
          revealed.push({ index, team });
          db.ref("game/revealedAnswers").set(revealed);
        });

        db.ref("game/scores").set(scores);
      }
    }

    function nextRound() {
      if (currentIndex < questions.length - 1) {
        currentIndex++;
        showQuestion();
      } else {
        alert("No more questions!");
      }
    }

    // Load last state from Firebase on load
    db.ref("game/scores").on("value", snap => {
      if (snap.exists()) {
        scores = snap.val();
        document.getElementById("team1Score").innerText = scores.team1;
        document.getElementById("team2Score").innerText = scores.team2;
      }
    });
  </script>
</body>
</html>
