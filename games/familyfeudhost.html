<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Family Feud Host</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; padding: 20px; }
    h1, h2 { text-align: center; }
    #question { font-size: 1.5em; margin-bottom: 20px; }
    .answer {
      display: flex; justify-content: space-between; align-items: center;
      background: #fff; padding: 10px; margin-bottom: 10px;
      border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button { padding: 8px 12px; margin: 5px; cursor: pointer; }
    .controls { text-align: center; margin: 20px 0; }
    .revealed { background-color: #d4edda; }
  </style>
</head>
<body>
  <h1>Family Feud - Host View</h1>

  <div class="controls">
    <button onclick="loadQuestions()">Load Questions from Google Sheets</button>
    <button onclick="nextRound()">Next Round</button>
  </div>

  <h2 id="question">Waiting for questions...</h2>
  <div id="answers"></div>

  <div class="controls">
    <p>Team A Score: <span id="teamAScore">0</span></p>
    <p>Team B Score: <span id="teamBScore">0</span></p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBX0VRJb78-uWfD3i4EwU1df1vPabG6m7k",
      authDomain: "family-feud-8b52e.firebaseapp.com",
      projectId: "family-feud-8b52e",
      storageBucket: "family-feud-8b52e.appspot.com",
      messagingSenderId: "604323429661",
      appId: "1:604323429661:web:f684108fa62dcf6979822d",
      databaseURL: "https://family-feud-8b52e-default-rtdb.firebaseio.com/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let questions = [];
    let currentIndex = 0;
    let teamAScore = 0;
    let teamBScore = 0;

    function loadQuestions() {
      fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vT8hWnxpAnGUMSl7VqP4rRFALVpaQ4LCd46XU_lyio6qSv847jmUUTX8EsQ3gRZ2db0hwTMVYfYlIPj/pub?output=tsv")
        .then(res => res.text())
        .then(text => {
          const rows = text.trim().split("\n").slice(1);
          questions = rows.map(row => {
            const cols = row.split("\t");
            return {
              question: cols[0],
              answers: [
                { text: cols[1], points: parseInt(cols[2]) },
                { text: cols[3], points: parseInt(cols[4]) },
                { text: cols[5], points: parseInt(cols[6]) },
                { text: cols[7], points: parseInt(cols[8]) },
                { text: cols[9], points: parseInt(cols[10]) },
                { text: cols[11], points: parseInt(cols[12]) }
              ].filter(ans => ans.text)
            };
          });
          currentIndex = 0;
          teamAScore = 0;
          teamBScore = 0;
          updateScoreUI();
          showQuestion();
        });
    }

    function showQuestion() {
      if (!questions[currentIndex]) return;

      const q = questions[currentIndex];
      document.getElementById("question").innerText = q.question;

      const answersDiv = document.getElementById("answers");
      answersDiv.innerHTML = "";

      q.answers.forEach((ans, i) => {
        const div = document.createElement("div");
        div.className = "answer";
        div.id = `answer-${i}`;
        div.innerHTML = `
          <span>${ans.text} (${ans.points} pts)</span>
          <div>
            <button onclick="reveal(${i}, 'A')">Team A Reveal</button>
            <button onclick="reveal(${i}, 'B')">Team B Reveal</button>
          </div>`;
        answersDiv.appendChild(div);
      });

      // Save initial state to Firebase with answers unrevealed and current scores
      db.ref("game/current").set({
        question: q.question,
        answers: q.answers.map(a => ({ text: a.text, points: a.points, revealed: false })),
        team1: teamAScore,
        team2: teamBScore
      });
    }

    function reveal(index, team) {
      const q = questions[currentIndex];
      const answer = q.answers[index];
      const answerDiv = document.getElementById(`answer-${index}`);
      answerDiv.classList.add("revealed");

      if (team === "A") teamAScore += answer.points;
      else if (team === "B") teamBScore += answer.points;

      updateScoreUI();

      // Update the whole answers array with revealed flags in Firebase
      db.ref("game/current").once("value").then(snap => {
        const data = snap.val() || {};
        const answers = data.answers || [];

        answers[index] = {
          text: answer.text,
          points: answer.points,
          revealed: true
        };

        db.ref("game/current").set({
          question: q.question,
          answers: answers,
          team1: teamAScore,
          team2: teamBScore
        });
      });
    }

    function updateScoreUI() {
      document.getElementById("teamAScore").innerText = teamAScore;
      document.getElementById("teamBScore").innerText = teamBScore;
    }

    function nextRound() {
      if (currentIndex + 1 < questions.length) {
        currentIndex++;
        showQuestion();
      } else {
        alert("No more questions.");
      }
    }
  </script>
</body>
</html>
