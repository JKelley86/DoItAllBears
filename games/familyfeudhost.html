<!DOCTYPE html>
<html>
<head>
  <title>Family Feud Host</title>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Family Feud - Host</h1>
  <button onclick="loadQuestions()">Load Questions</button>
  <button onclick="nextQuestion()">Next Round</button>
  <div id="question"></div>
  <ul id="answers"></ul>
  <h2>Scores</h2>
  <p>Team A: <span id="scoreA">0</span></p>
  <p>Team B: <span id="scoreB">0</span></p>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBY8wm-BiRozfkQw9GontLmX-6uIMpavjc",
      authDomain: "family-feud-game-ea08a.firebaseapp.com",
      projectId: "family-feud-game-ea08a",
      storageBucket: "family-feud-game-ea08a.appspot.com",
      messagingSenderId: "901336964187",
      appId: "1:901336964187:web:53534171e5ebf2a751337e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let questions = [];
    let currentIndex = -1;
    let scores = { A: 0, B: 0 };

    function loadQuestions() {
      fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vT8hWnxpAnGUMSl7VqP4rRFALVpaQ4LCd46XU_lyio6qSv847jmUUTX8EsQ3gRZ2db0hwTMVYfYlIPj/pub?output=csv")
        .then(res => res.text())
        .then(csv => {
          const lines = csv.trim().split("\n");
          const headers = lines[0].split(",");
          for (let i = 1; i < lines.length; i++) {
            const cols = lines[i].split(",");
            const q = {
              question: cols[0],
              answers: []
            };
            for (let j = 1; j < cols.length; j += 2) {
              if (cols[j]) {
                q.answers.push({ text: cols[j], points: parseInt(cols[j+1]) || 0, revealed: false });
              }
            }
            questions.push(q);
          }
          alert("Questions loaded!");
        });
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex >= questions.length) {
        alert("No more questions!");
        return;
      }
      const current = questions[currentIndex];
      current.answers.forEach(a => a.revealed = false);
      updateGameState(current);
    }

    function updateGameState(q) {
      db.ref("game").set({
        question: q.question,
        answers: q.answers,
        scores
      });
    }

    function awardPoints(team, index) {
      const current = questions[currentIndex];
      if (!current.answers[index].revealed) {
        current.answers[index].revealed = true;
        scores[team] += current.answers[index].points;
        updateGameState(current);
      }
    }

    db.ref("game").on("value", snapshot => {
      const game = snapshot.val();
      if (!game) return;
      document.getElementById("question").textContent = game.question;
      document.getElementById("scoreA").textContent = game.scores?.A || 0;
      document.getElementById("scoreB").textContent = game.scores?.B || 0;

      const ul = document.getElementById("answers");
      ul.innerHTML = "";
      game.answers?.forEach((a, i) => {
        const li = document.createElement("li");
        li.innerHTML = a.revealed ? `${a.text} (${a.points})` :
          `<button onclick="awardPoints('A', ${i})">Reveal for Team A</button>
           <button onclick="awardPoints('B', ${i})">Reveal for Team B</button>`;
        ul.appendChild(li);
      });
    });
  </script>
</body>
</html>
