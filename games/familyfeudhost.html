<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Family Feud - Host</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1c1c1c;
      color: white;
      text-align: center;
      padding: 20px;
    }

    h1 { color: gold; }

    #answers { margin-top: 20px; }

    .answer {
      background: #333;
      margin: 5px auto;
      padding: 10px;
      width: 80%;
      border: 2px solid white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .buttons button {
      margin-left: 10px;
      padding: 5px 10px;
      font-weight: bold;
      cursor: pointer;
    }

    .revealed {
      background: darkgreen;
    }

    .controls {
      margin-top: 30px;
    }

    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>Family Feud - Host</h1>
<div id="question"></div>
<div id="answers"></div>

<div class="controls">
  <button onclick="loadQuestions()">Load Questions</button>
  <button onclick="nextRound()">Next Round</button>
  <div>Team A: <span id="scoreA">0</span> | Team B: <span id="scoreB">0</span></div>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBY8wm-BiRozfkQw9GontLmX-6uIMpavjc",
    authDomain: "family-feud-game-ea08a.firebaseapp.com",
    projectId: "family-feud-game-ea08a",
    storageBucket: "family-feud-game-ea08a.appspot.com",
    messagingSenderId: "901336964187",
    appId: "1:901336964187:web:53534171e5ebf2a751337e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let questions = [];
  let currentQuestionIndex = 0;
  let scores = { A: 0, B: 0 };

  function loadQuestions() {
    fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vT8hWnxpAnGUMSl7VqP4rRFALVpaQ4LCd46XU_lyio6qSv847jmUUTX8EsQ3gRZ2db0hwTMVYfYlIPj/pub?output=csv")
      .then(res => res.text())
      .then(csv => {
        questions = [];
        const rows = csv.split("\n").slice(1); // skip header
        for (let row of rows) {
          const [question, a1, p1, a2, p2, a3, p3, a4, p4, a5, p5, a6, p6, a7, p7, a8, p8] = row.split(",");
          questions.push({
            question,
            answers: [
              { text: a1, points: parseInt(p1) },
              { text: a2, points: parseInt(p2) },
              { text: a3, points: parseInt(p3) },
              { text: a4, points: parseInt(p4) },
              { text: a5, points: parseInt(p5) },
              { text: a6, points: parseInt(p6) },
              { text: a7, points: parseInt(p7) },
              { text: a8, points: parseInt(p8) },
            ].filter(a => a.text)
          });
        }
        nextRound();
      });
  }

  function nextRound() {
    if (currentQuestionIndex >= questions.length) currentQuestionIndex = 0;
    const current = questions[currentQuestionIndex++];
    document.getElementById("question").textContent = current.question;

    const answersDiv = document.getElementById("answers");
    answersDiv.innerHTML = "";

    current.answers.forEach((ans, i) => {
      const div = document.createElement("div");
      div.className = "answer";
      div.id = `answer-${i}`;
      div.innerHTML = `
        <span>${i + 1}. <span id="text-${i}">???</span> - <span id="points-${i}"></span></span>
        <div class="buttons">
          <button onclick="revealAnswer(${i}, 'A')">Team A</button>
          <button onclick="revealAnswer(${i}, 'B')">Team B</button>
        </div>
      `;
      answersDiv.appendChild(div);
    });

    syncToFirebase(current);
  }

  function revealAnswer(index, team) {
    const ans = questions[currentQuestionIndex - 1].answers[index];
    document.getElementById(`text-${index}`).textContent = ans.text;
    document.getElementById(`points-${index}`).textContent = ans.points;
    document.getElementById(`answer-${index}`).classList.add("revealed");

    scores[team] += ans.points;
    document.getElementById("scoreA").textContent = scores.A;
    document.getElementById("scoreB").textContent = scores.B;

    // update Firebase state
    updateFirebaseReveal(index, ans, team);
  }

  function syncToFirebase(questionData) {
    const roundData = {
      question: questionData.question,
      answers: questionData.answers.map(a => ({ text: "???", points: "" })),
      scores
    };
    set(ref(db, "game"), roundData);
  }

  function updateFirebaseReveal(index, ans, team) {
    onValue(ref(db, "game"), snapshot => {
      const gameData = snapshot.val();
      if (!gameData) return;

      gameData.answers[index] = { text: ans.text, points: ans.points };
      gameData.scores = scores;
      set(ref(db, "game"), gameData);
    }, { onlyOnce: true });
  }
</script>
</body>
</html>
