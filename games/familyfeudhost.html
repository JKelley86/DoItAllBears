<!DOCTYPE html>
<html>
<head>
  <title>Family Feud - Host</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: white;
      text-align: center;
    }
    .answer {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 10px 0;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h1>Host View - Family Feud</h1>

  <button onclick="loadQuestions()">Load Questions from Google Sheets</button>
  <button onclick="nextRound()">Next Round</button>

  <h2 id="question">Click "Next Round" to begin</h2>

  <div id="answers"></div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyBY8wm-BiRozfkQw9GontLmX-6uIMpavjc",
      authDomain: "family-feud-game-ea08a.firebaseapp.com",
      projectId: "family-feud-game-ea08a",
      storageBucket: "family-feud-game-ea08a.appspot.com",
      messagingSenderId: "901336964187",
      appId: "1:901336964187:web:53534171e5ebf2a751337e"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentRound = -1;
    let sheetData = [];

    async function loadQuestions() {
      const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT8hWnxpAnGUMSl7VqP4rRFALVpaQ4LCd46XU_lyio6qSv847jmUUTX8EsQ3gRZ2db0hwTMVYfYlIPj/pub?output=csv";
      const response = await fetch(url);
      const text = await response.text();
      const rows = text.trim().split('\n').map(row => row.split(','));
      
      sheetData = rows.map(cells => ({
        question: cells[0],
        answers: cells.slice(1).map(cell => {
          const [text, points] = cell.split('|');
          return { text: text?.trim(), points: Number(points) || 0, revealed: false };
        }).filter(ans => ans.text)
      }));

      alert("Questions loaded successfully!");
    }

    function nextRound() {
      if (sheetData.length === 0) {
        alert("Please load questions first.");
        return;
      }
      currentRound = (currentRound + 1) % sheetData.length;
      const qData = sheetData[currentRound];
      displayQuestion(qData);
      syncToFirebase(qData);
    }

    function displayQuestion(qData) {
      document.getElementById("question").innerText = qData.question;
      const answersDiv = document.getElementById("answers");
      answersDiv.innerHTML = '';

      qData.answers.forEach((ans, i) => {
        const div = document.createElement('div');
        div.className = "answer";
        div.id = `ans-${i}`;
        div.innerHTML = `
          <button onclick="revealAnswer(${i})">Reveal Answer ${i+1}</button>
          <span id="text-${i}" style="display:none;">${ans.text} - ${ans.points}</span>
        `;
        answersDiv.appendChild(div);
      });
    }

    function revealAnswer(index) {
      const span = document.getElementById(`text-${index}`);
      if (span) span.style.display = "inline";

      const qData = sheetData[currentRound];
      qData.answers[index].revealed = true;
      syncToFirebase(qData);
    }

    function syncToFirebase(qData) {
      db.ref("game").set({
        question: qData.question,
        answers: qData.answers
      });
    }
  </script>
</body>
</html>
