<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Garden</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }

    header {
      display: flex;
      justify-content: flex-end;
      padding: 10px;
      background: #4CAF50;
      color: white;
    }

    .config-btn {
      background: white;
      color: #4CAF50;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 4px;
      font-weight: bold;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    li {
      padding: 15px;
      margin: 8px;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Config Menu Overlay */
    .overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .config-menu {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }

    .config-menu h2 {
      margin-top: 0;
    }

    .config-menu label {
      display: block;
      margin: 8px 0;
    }

    .config-menu button {
      margin-top: 10px;
      padding: 8px 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Plant Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
    }

    .modal-content h2 {
      margin-top: 0;
    }

    .modal-content label {
      display: block;
      margin: 10px 0 5px;
    }

    .modal-content input, .modal-content textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    .modal-actions {
      text-align: right;
    }

    .modal-actions button {
      padding: 8px 12px;
      margin-left: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .save-btn {
      background: #4CAF50;
      color: white;
    }

    .cancel-btn {
      background: #ccc;
      color: black;
    }
  </style>
</head>
<body>
  <header>
    <button class="config-btn" onclick="openConfig()">Config</button>
  </header>

  <main>
    <ul id="plant-list"></ul>
  </main>

  <!-- Config Menu -->
  <div class="overlay" id="config-overlay">
    <div class="config-menu">
      <h2>Garden Config</h2>
      <div id="plant-checkboxes"></div>
      <button onclick="addNewPlant()">+ Add Plant</button>
      <button onclick="saveConfig()">Save</button>
      <button onclick="closeConfig()">Close</button>
    </div>
  </div>

  <!-- Plant Modal -->
  <div class="modal" id="plant-modal">
    <div class="modal-content">
      <h2 id="plant-title">Plant Details</h2>
      <label>When to plant:</label>
      <input type="text" id="whenToPlant">
      <label>Sun:</label>
      <input type="text" id="sun">
      <label>Spacing:</label>
      <input type="text" id="spacing">
      <label>Time to first harvest:</label>
      <input type="text" id="harvestTime">
      <label>How to winterize:</label>
      <input type="text" id="winterize">
      <label>Notes:</label>
      <textarea id="notes"></textarea>
      <div class="modal-actions">
        <button class="cancel-btn" onclick="closePlantModal()">Cancel</button>
        <button class="save-btn" onclick="savePlantDetails()">Save</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD3RT8GwOdg3G3bGm4SKLm1XMKdifW63WU",
      authDomain: "mygarden-3440d.firebaseapp.com",
      projectId: "mygarden-3440d",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const plantList = document.getElementById("plant-list");
    const configOverlay = document.getElementById("config-overlay");
    const plantCheckboxes = document.getElementById("plant-checkboxes");

    let currentPlant = null;

    function openConfig() {
      configOverlay.style.display = "flex";
      loadConfig();
    }

    function closeConfig() {
      configOverlay.style.display = "none";
    }

    async function loadConfig() {
      const snapshot = await db.collection("garden").doc("shared").get();
      const data = snapshot.data() || { selectedPlants: [] };

      plantCheckboxes.innerHTML = "";
      const allPlantsSnap = await db.collection("garden").doc("shared").collection("plants").get();

      allPlantsSnap.forEach(doc => {
        const name = doc.id;
        const checked = data.selectedPlants.includes(name) ? "checked" : "";
        plantCheckboxes.innerHTML += `
          <label>
            <input type="checkbox" value="${name}" ${checked}> ${name}
          </label>`;
      });
    }

    async function saveConfig() {
      const checkboxes = plantCheckboxes.querySelectorAll("input[type=checkbox]");
      const selected = [];
      checkboxes.forEach(cb => {
        if (cb.checked) selected.push(cb.value);
      });
      await db.collection("garden").doc("shared").set({ selectedPlants: selected }, { merge: true });
      loadPlants();
      closeConfig();
    }

    async function loadPlants() {
      const snapshot = await db.collection("garden").doc("shared").get();
      const data = snapshot.data() || { selectedPlants: [] };

      plantList.innerHTML = "";
      for (const name of data.selectedPlants) {
        const li = document.createElement("li");
        li.textContent = name;
        li.onclick = () => openPlantModal(name);
        plantList.appendChild(li);
      }
    }

    async function openPlantModal(name) {
      currentPlant = name;
      const docRef = db.collection("garden").doc("shared").collection("plants").doc(name);
      const doc = await docRef.get();
      const data = doc.data() || {};

      document.getElementById("plant-title").textContent = name;
      document.getElementById("whenToPlant").value = data.whenToPlant || "";
      document.getElementById("sun").value = data.sun || "";
      document.getElementById("spacing").value = data.spacing || "";
      document.getElementById("harvestTime").value = data.harvestTime || "";
      document.getElementById("winterize").value = data.winterize || "";
      document.getElementById("notes").value = data.notes || "";

      document.getElementById("plant-modal").style.display = "flex";
    }

    function closePlantModal() {
      document.getElementById("plant-modal").style.display = "none";
    }

    async function savePlantDetails() {
      if (!currentPlant) return;

      const details = {
        whenToPlant: document.getElementById("whenToPlant").value,
        sun: document.getElementById("sun").value,
        spacing: document.getElementById("spacing").value,
        harvestTime: document.getElementById("harvestTime").value,
        winterize: document.getElementById("winterize").value,
        notes: document.getElementById("notes").value,
      };

      await db.collection("garden").doc("shared").collection("plants").doc(currentPlant).set(details, { merge: true });
      closePlantModal();
    }

    async function addNewPlant() {
      const name = prompt("Enter new plant name:");
      if (!name) return;

      await db.collection("garden").doc("shared").collection("plants").doc(name).set({});
      loadConfig();
    }

    loadPlants();
  </script>
</body>
</html>
